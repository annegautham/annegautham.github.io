---
import { getCollection, type CollectionEntry } from "astro:content";
import NoteLayout from "@layouts/NoteLayout.astro";
import Markdown from "@layouts/Markdown.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";

const notes = await getCollection("notes");

const ashcroftNotes = notes
  .filter(
    note =>
      note.id.startsWith("ashcroft_mermin/") && !note.id.endsWith("index.md") // skip index page
  )
  .sort((a, b) => (a.data.order ?? 0) - (b.data.order ?? 0));

const ashcroftIndexNote = notes.find(
  note => note.id === "ashcroft_mermin/index.md"
);

const { slug } = Astro.params;
const current = ashcroftNotes.find(n => n.slug.split("/").at(-1) === slug);

export async function getStaticPaths() {
  const notes = await getCollection("notes");
  const ashcroftNotes = notes.filter(
    note =>
      note.id.startsWith("ashcroft_mermin/") &&
      note.slug !== "ashcroft_mermin/index"
  );

  return ashcroftNotes.map(note => ({
    params: { slug: note.slug.split("/").at(-1) },
  }));
}
---

<Header />

<NoteLayout ashcroftNotes={ashcroftNotes} current={current}>
  <Markdown content={await current?.render()} />
</NoteLayout>

<Footer />
---

